<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 { color: #333; margin-top: 0; }
        h2 { color: #666; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .error { background: #f44336; }
        .error:hover { background: #da190b; }
        .info { background: #2196F3; }
        .info:hover { background: #0b7dda; }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
            border-left: 4px solid #4CAF50;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.pending { background: #ff9800; color: white; }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        .endpoint-test {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background: #fafafa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® å¾·å·æ‰‘å…‹ API æµ‹è¯•å·¥å…·</h1>
        <p>æœåŠ¡å™¨: <strong id="server-url">http://13.212.252.171</strong></p>
        <label>
            åç«¯ç«¯å£: <input type="number" id="backend-port" value="8000" style="width: 100px;">
        </label>
        <label>
            å‰ç«¯ç«¯å£: <input type="number" id="frontend-port" value="3000" style="width: 100px;">
        </label>
    </div>

    <div class="container">
        <h2>1. å¥åº·æ£€æŸ¥</h2>
        <button onclick="testHealth()">æµ‹è¯• /health</button>
        <button onclick="testRoot()">æµ‹è¯• / (æ ¹è·¯å¾„)</button>
        <div id="health-result"></div>
    </div>

    <div class="container">
        <h2>2. æ¸¸æˆç®¡ç†</h2>
        <button onclick="createGame()">åˆ›å»ºæ¸¸æˆ</button>
        <button onclick="startGame()" id="start-btn" disabled>å¼€å§‹æ¸¸æˆ</button>
        <button onclick="getGame()" id="get-btn" disabled>è·å–æ¸¸æˆçŠ¶æ€</button>
        <div>å½“å‰æ¸¸æˆ ID: <strong id="current-game-id">æ— </strong></div>
        <div id="game-result"></div>
    </div>

    <div class="container">
        <h2>3. AI åŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testAIAction()" id="ai-btn" disabled>æµ‹è¯• AI å•æ­¥åŠ¨ä½œ</button>
        <button onclick="testAIAction10()" id="ai10-btn" disabled>æ‰§è¡Œ 10 æ¬¡ AI åŠ¨ä½œ</button>
        <div id="ai-result"></div>
    </div>

    <div class="container">
        <h2>4. ç«¯ç‚¹å­˜åœ¨æ€§æ£€æŸ¥</h2>
        <button onclick="checkEndpoints()">æ£€æŸ¥æ‰€æœ‰ç«¯ç‚¹</button>
        <div id="endpoints-result"></div>
    </div>

    <script>
        let currentGameId = null;
        const SERVER = 'http://13.212.252.171';

        function getBackendURL() {
            const port = document.getElementById('backend-port').value;
            return `${SERVER}:${port}`;
        }

        function getFrontendURL() {
            const port = document.getElementById('frontend-port').value;
            return `${SERVER}:${port}`;
        }

        async function testHealth() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.innerHTML = '<span class="status pending">æµ‹è¯•ä¸­...</span>';

            try {
                const response = await fetch(`${getBackendURL()}/health`);
                const data = await response.json();
                resultDiv.innerHTML = `
                    <span class="status success">âœ“ æˆåŠŸ</span>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.innerHTML = `
                    <span class="status error">âœ— å¤±è´¥</span>
                    <pre>${err.message}</pre>
                `;
            }
        }

        async function testRoot() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.innerHTML = '<span class="status pending">æµ‹è¯•ä¸­...</span>';

            try {
                const response = await fetch(`${getBackendURL()}/`);
                const data = await response.json();
                resultDiv.innerHTML = `
                    <span class="status success">âœ“ æˆåŠŸ</span>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.innerHTML = `
                    <span class="status error">âœ— å¤±è´¥</span>
                    <pre>${err.message}</pre>
                `;
            }
        }

        async function createGame() {
            const resultDiv = document.getElementById('game-result');
            resultDiv.innerHTML = '<span class="status pending">åˆ›å»ºä¸­...</span>';

            try {
                const response = await fetch(`${getBackendURL()}/api/games`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        num_players: 4,
                        small_blind: 10,
                        big_blind: 20
                    })
                });
                const data = await response.json();
                currentGameId = data.game_id;
                document.getElementById('current-game-id').textContent = currentGameId;
                document.getElementById('start-btn').disabled = false;
                document.getElementById('get-btn').disabled = false;
                document.getElementById('ai-btn').disabled = false;
                document.getElementById('ai10-btn').disabled = false;

                resultDiv.innerHTML = `
                    <span class="status success">âœ“ åˆ›å»ºæˆåŠŸ</span>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.innerHTML = `
                    <span class="status error">âœ— å¤±è´¥</span>
                    <pre>${err.message}</pre>
                `;
            }
        }

        async function startGame() {
            if (!currentGameId) {
                alert('è¯·å…ˆåˆ›å»ºæ¸¸æˆ');
                return;
            }

            const resultDiv = document.getElementById('game-result');
            resultDiv.innerHTML = '<span class="status pending">å¼€å§‹ä¸­...</span>';

            try {
                const response = await fetch(`${getBackendURL()}/api/games/${currentGameId}/start`, {
                    method: 'POST'
                });
                const data = await response.json();

                resultDiv.innerHTML = `
                    <span class="status success">âœ“ æ¸¸æˆå·²å¼€å§‹</span>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.innerHTML = `
                    <span class="status error">âœ— å¤±è´¥</span>
                    <pre>${err.message}</pre>
                `;
            }
        }

        async function getGame() {
            if (!currentGameId) {
                alert('è¯·å…ˆåˆ›å»ºæ¸¸æˆ');
                return;
            }

            const resultDiv = document.getElementById('game-result');
            resultDiv.innerHTML = '<span class="status pending">è·å–ä¸­...</span>';

            try {
                const response = await fetch(`${getBackendURL()}/api/games/${currentGameId}`);
                const data = await response.json();

                resultDiv.innerHTML = `
                    <span class="status success">âœ“ è·å–æˆåŠŸ</span>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.innerHTML = `
                    <span class="status error">âœ— å¤±è´¥</span>
                    <pre>${err.message}</pre>
                `;
            }
        }

        async function testAIAction() {
            if (!currentGameId) {
                alert('è¯·å…ˆåˆ›å»ºæ¸¸æˆ');
                return;
            }

            const resultDiv = document.getElementById('ai-result');
            resultDiv.innerHTML = '<span class="status pending">æ‰§è¡Œ AI åŠ¨ä½œä¸­...</span>';

            try {
                const response = await fetch(`${getBackendURL()}/api/games/${currentGameId}/ai-action`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();

                resultDiv.innerHTML = `
                    <span class="status success">âœ“ AI åŠ¨ä½œæˆåŠŸ</span>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.innerHTML = `
                    <span class="status error">âœ— å¤±è´¥</span>
                    <pre>${err.message}</pre>
                `;
            }
        }

        async function testAIAction10() {
            if (!currentGameId) {
                alert('è¯·å…ˆåˆ›å»ºæ¸¸æˆ');
                return;
            }

            const resultDiv = document.getElementById('ai-result');
            resultDiv.innerHTML = '<span class="status pending">æ‰§è¡Œ 10 æ¬¡ AI åŠ¨ä½œä¸­...</span>';

            let results = [];
            for (let i = 0; i < 10; i++) {
                try {
                    const response = await fetch(`${getBackendURL()}/api/games/${currentGameId}/ai-action`, {
                        method: 'POST'
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        results.push({ step: i + 1, error: `HTTP ${response.status}` });
                        break;
                    }

                    const data = await response.json();
                    results.push({ step: i + 1, success: true, action: data.action, player: data.player_id });

                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (err) {
                    results.push({ step: i + 1, error: err.message });
                    break;
                }
            }

            resultDiv.innerHTML = `
                <span class="status ${results.every(r => r.success) ? 'success' : 'error'}">
                    ${results.every(r => r.success) ? 'âœ“' : 'âœ—'} å®Œæˆ
                </span>
                <pre>${JSON.stringify(results, null, 2)}</pre>
            `;
        }

        async function checkEndpoints() {
            const resultDiv = document.getElementById('endpoints-result');
            resultDiv.innerHTML = '<span class="status pending">æ£€æŸ¥ä¸­...</span>';

            const endpoints = [
                { method: 'GET', path: '/', name: 'æ ¹è·¯å¾„' },
                { method: 'GET', path: '/health', name: 'å¥åº·æ£€æŸ¥' },
                { method: 'GET', path: '/api/games/stats', name: 'æ¸¸æˆç»Ÿè®¡' },
                { method: 'POST', path: '/api/games', name: 'åˆ›å»ºæ¸¸æˆ', body: {num_players: 2, small_blind: 5, big_blind: 10} },
            ];

            let html = '<div>';
            for (const endpoint of endpoints) {
                try {
                    const options = { method: endpoint.method };
                    if (endpoint.body) {
                        options.headers = { 'Content-Type': 'application/json' };
                        options.body = JSON.stringify(endpoint.body);
                    }

                    const response = await fetch(`${getBackendURL()}${endpoint.path}`, options);
                    const status = response.ok ? 'success' : 'error';
                    const icon = response.ok ? 'âœ“' : 'âœ—';

                    html += `
                        <div class="endpoint-test">
                            <span class="status ${status}">${icon}</span>
                            <strong>${endpoint.method} ${endpoint.path}</strong> (${endpoint.name})
                            <br>çŠ¶æ€ç : ${response.status}
                        </div>
                    `;
                } catch (err) {
                    html += `
                        <div class="endpoint-test">
                            <span class="status error">âœ—</span>
                            <strong>${endpoint.method} ${endpoint.path}</strong> (${endpoint.name})
                            <br>é”™è¯¯: ${err.message}
                        </div>
                    `;
                }
            }
            html += '</div>';

            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>

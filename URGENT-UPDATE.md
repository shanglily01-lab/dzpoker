# ç´§æ€¥æ›´æ–°æŒ‡ä»¤
# Urgent Update Instructions

## ğŸ”´ å¿…é¡»ç«‹å³æ‰§è¡Œçš„æ›´æ–°

å‘ç°å…³é”®é—®é¢˜ï¼š**nginx ä»£ç†é…ç½®é”™è¯¯å¯¼è‡´å‰ç«¯æ— æ³•è®¿é—® API**

### é—®é¢˜ç—‡çŠ¶
```
GET http://13.212.252.171:3000/api/games/xxx 404 (Not Found)
POST http://13.212.252.171:3000/api/games/xxx/start 404 (Not Found)
```

### æ ¹æœ¬åŸå› 
nginx é…ç½®ä¸­ `location /api` å’Œ `proxy_pass` è·¯å¾„ä¸åŒ¹é…

---

## âš¡ ç«‹å³æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

### æ–¹æ³•1: ä¸€é”®æ›´æ–°ï¼ˆæ¨èï¼‰

```bash
ssh user@13.212.252.171 "cd dzpoker && git pull origin master && docker-compose down && docker-compose up -d --build"
```

### æ–¹æ³•2: åˆ†æ­¥æ‰§è¡Œ

```bash
# 1. SSH ç™»å½•
ssh user@13.212.252.171

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd dzpoker

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# 4. å®Œå…¨é‡å¯æœåŠ¡ï¼ˆå› ä¸ºæ”¹äº† nginx é…ç½®ï¼‰
docker-compose down
docker-compose up -d --build

# 5. æ£€æŸ¥çŠ¶æ€
docker-compose ps
```

### âš ï¸ æ³¨æ„
è¿™æ¬¡**å¿…é¡»ä½¿ç”¨ `--build`** å› ä¸ºï¼š
- ä¿®æ”¹äº† `frontend/nginx.conf`
- nginx é…ç½®æ–‡ä»¶åœ¨ Docker é•œåƒæ„å»ºæ—¶å¤åˆ¶
- ä¸ rebuild çš„è¯é…ç½®ä¸ä¼šæ›´æ–°

---

## ğŸ§ª æ›´æ–°åéªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```
æ‰€æœ‰æœåŠ¡åº”è¯¥éƒ½æ˜¯ `Up` çŠ¶æ€

### 2. æµ‹è¯• nginx ä»£ç†
```bash
# é€šè¿‡ nginx è®¿é—®å¥åº·æ£€æŸ¥
curl http://13.212.252.171:3000/api/health
# åº”è¯¥è¿”å›: 404 æˆ–å…¶ä»–é”™è¯¯ï¼ˆå› ä¸º /health ä¸åœ¨ /api è·¯å¾„ä¸‹ï¼‰

# æµ‹è¯•åˆ›å»ºæ¸¸æˆ
curl -X POST http://13.212.252.171:3000/api/games \
  -H "Content-Type: application/json" \
  -d '{"num_players": 4, "small_blind": 10, "big_blind": 20}'
# åº”è¯¥è¿”å›: {"game_id":"xxx",...}
```

### 3. æµ‹è¯•å‰ç«¯
1. è®¿é—® http://13.212.252.171:3000
2. ç‚¹å‡»"åˆ›å»ºæ¸¸æˆ"
3. è¿›å…¥æ¸¸æˆé¡µé¢
4. ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"
5. åº”è¯¥ä¸å†å‡ºç° 404 é”™è¯¯

---

## ğŸ“Š æœ¬æ¬¡æ›´æ–°å†…å®¹

### Commit: adacd83

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `frontend/nginx.conf`

**å˜æ›´è¯¦æƒ…**ï¼š

#### ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰ï¼š
```nginx
location /api {
    proxy_pass http://api:8000;
}
```

#### ä¹‹åï¼ˆæ­£ç¡®ï¼‰ï¼š
```nginx
location /api/ {
    proxy_pass http://api:8000/api/;
    # æ·»åŠ äº†è½¬å‘å¤´
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

**å…³é”®å˜åŒ–**ï¼š
1. `location /api` â†’ `location /api/` (æ·»åŠ æœ«å°¾æ–œæ )
2. `proxy_pass http://api:8000` â†’ `proxy_pass http://api:8000/api/` (æ·»åŠ å®Œæ•´è·¯å¾„)
3. æ·»åŠ å¿…è¦çš„ä»£ç†è½¬å‘å¤´

---

## ğŸ› å·²ä¿®å¤çš„é—®é¢˜æ¸…å•

| é—®é¢˜ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| AI æ‰§è¡Œå¤±è´¥ 500 é”™è¯¯ | âœ… | æ·»åŠ  ai-action ç«¯ç‚¹ |
| æ¸¸æˆä¸å­˜åœ¨ 404 é”™è¯¯ | âœ… | æ·»åŠ å‹å¥½é”™è¯¯æç¤º |
| nginx ä»£ç† 404 é”™è¯¯ | âœ… | ä¿®å¤ proxy_pass é…ç½® |

---

## ğŸ“‹ å‰©ä½™å¾…è§£å†³é—®é¢˜

### é«˜ä¼˜å…ˆçº§
1. **æ¸¸æˆæŒä¹…åŒ–åˆ° Redis** - æ¸¸æˆçŠ¶æ€åœ¨å†…å­˜ä¸­ï¼ŒæœåŠ¡å™¨é‡å¯åä¸¢å¤±
2. **æ›´æ–° EC2 æœåŠ¡å™¨ä»£ç ** - å½“å‰æœåŠ¡å™¨è¿è¡Œæ—§ä»£ç 

### ä¸­ä¼˜å…ˆçº§
3. PlayerStats è¿æ¥çœŸå®API
4. ç©å®¶è¶…æ—¶è‡ªåŠ¨å¼ƒç‰Œ

### ä½ä¼˜å…ˆçº§
5. è¾¹æ± ï¼ˆSide Potï¼‰é€»è¾‘
6. JWT è®¤è¯

---

## â±ï¸ é¢„è®¡æ›´æ–°æ—¶é—´

- **ä»£ç æ‹‰å–**: 10-30ç§’ï¼ˆå–å†³äºç½‘ç»œï¼‰
- **æ„å»ºé•œåƒ**: 2-3åˆ†é’Ÿï¼ˆå‰ç«¯éœ€è¦é‡æ–°æ„å»ºï¼‰
- **å¯åŠ¨æœåŠ¡**: 10-30ç§’
- **æ€»è®¡**: çº¦ 3-5 åˆ†é’Ÿ

---

## ğŸ†˜ å¦‚æœæ›´æ–°å¤±è´¥

### æ£€æŸ¥ Docker æ—¥å¿—
```bash
docker logs frontend --tail 50
docker logs backend --tail 50
```

### æ£€æŸ¥ nginx é…ç½®
```bash
docker exec frontend nginx -t
```

### é‡ç½®å¹¶é‡æ–°æ„å»º
```bash
docker-compose down -v
docker system prune -f
git pull origin master
docker-compose up -d --build
```

---

## ğŸ“ éªŒè¯æˆåŠŸçš„æ ‡å¿—

æ›´æ–°æˆåŠŸåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

1. âœ… å‰ç«¯å¯ä»¥è®¿é—®ï¼šhttp://13.212.252.171:3000
2. âœ… å¯ä»¥åˆ›å»ºæ¸¸æˆ
3. âœ… ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"ä¸æŠ¥ 404 é”™è¯¯
4. âœ… AI è‡ªåŠ¨æ¸¸æˆåŠŸèƒ½æ­£å¸¸å·¥ä½œ
5. âœ… æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰ 404 é”™è¯¯

---

ç”Ÿæˆæ—¶é—´: 2026-01-12
ç´§æ€¥ç¨‹åº¦: ğŸ”´ é«˜
é¢„è®¡è§£å†³æ—¶é—´: 5 åˆ†é’Ÿ

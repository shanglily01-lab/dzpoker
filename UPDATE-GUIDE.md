# ä»£ç æ›´æ–°æŒ‡å—
# Code Update Guide

## ğŸš€ å¿«é€Ÿæ›´æ–°ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šä¿®æ”¹äº† Python æˆ– JavaScript ä»£ç 

```bash
# æ–¹æ³•1: ä½¿ç”¨å¿«é€Ÿæ›´æ–°è„šæœ¬
./quick-update.sh

# æ–¹æ³•2: æ‰‹åŠ¨æ‰§è¡Œ
git pull origin master
docker-compose restart
```

**ä¼˜ç‚¹**ï¼š
- âš¡ éå¸¸å¿«ï¼ˆ5-10ç§’ï¼‰
- ä¸éœ€è¦é‡æ–°æ„å»ºé•œåƒ
- ä¸éœ€è¦é‡æ–°å®‰è£…ä¾èµ–
- æœåŠ¡å‡ ä¹æ— ç¼é‡å¯

**åŸç†**ï¼š
- Docker å®¹å™¨çš„ä»£ç ç›®å½•é€šè¿‡ volume æŒ‚è½½
- æ‹‰å–æœ€æ–°ä»£ç åï¼Œæ–‡ä»¶è‡ªåŠ¨æ›´æ–°
- é‡å¯å®¹å™¨å³å¯åŠ è½½æ–°ä»£ç 

---

## ğŸ”¨ å®Œæ•´é‡æ–°æ„å»º

**é€‚ç”¨åœºæ™¯**ï¼šä¿®æ”¹äº†ä»¥ä¸‹å†…å®¹æ—¶æ‰éœ€è¦

- âœ… Dockerfile
- âœ… requirements.txt (Python ä¾èµ–)
- âœ… package.json (Node.js ä¾èµ–)
- âœ… docker-compose.yml
- âœ… æ·»åŠ äº†æ–°çš„ç³»ç»ŸåŒ…

```bash
# å®Œæ•´é‡æ–°æ„å»º
git pull origin master
docker-compose down
docker-compose up -d --build
```

**æ—¶é—´**ï¼š3-5åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

---

## ğŸ“‹ æ›´æ–°æ­¥éª¤å¯¹æ¯”

| æ“ä½œ | å¿«é€Ÿæ›´æ–° | å®Œæ•´æ„å»º |
|------|---------|---------|
| git pull | âœ… | âœ… |
| åœæ­¢æœåŠ¡ | âŒ (åªé‡å¯) | âœ… docker-compose down |
| é‡æ–°æ„å»ºé•œåƒ | âŒ | âœ… --build |
| å®‰è£…ä¾èµ– | âŒ | âœ… |
| å¯åŠ¨æœåŠ¡ | âœ… restart | âœ… up -d |
| è€—æ—¶ | 5-10ç§’ | 3-5åˆ†é’Ÿ |

---

## ğŸ¯ æœ¬æ¬¡æ›´æ–°ï¼ˆAI è‡ªåŠ¨æ¸¸æˆåŠŸèƒ½ï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… `backend/app/routers/games.py` - Python ä»£ç 
- âœ… `frontend/src/api/index.js` - JavaScript ä»£ç 

**æ›´æ–°æ–¹å¼**ï¼šåªéœ€å¿«é€Ÿæ›´æ–° âš¡

```bash
# EC2 æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd dzpoker
git pull origin master
docker-compose restart

# æˆ–è€…ä»æœ¬åœ°ä¸€é”®æ‰§è¡Œ
ssh user@13.212.252.171 "cd dzpoker && git pull origin master && docker-compose restart"
```

---

## ğŸ” éªŒè¯æ›´æ–°æ˜¯å¦æˆåŠŸ

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```
åº”è¯¥çœ‹åˆ°æ‰€æœ‰æœåŠ¡éƒ½æ˜¯ `Up` çŠ¶æ€

### 2. æ£€æŸ¥åç«¯æ—¥å¿—
```bash
docker logs backend --tail 50
```
åº”è¯¥çœ‹åˆ°ï¼š
- ğŸš€ æ­£åœ¨å¯åŠ¨æœåŠ¡...
- âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- âœ… Redisè¿æ¥æˆåŠŸ

### 3. æµ‹è¯• API ç«¯ç‚¹
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://13.212.252.171:8000/health
# åº”è¯¥è¿”å›: {"status":"healthy"}

# æµ‹è¯•åˆ›å»ºæ¸¸æˆ
curl -X POST http://13.212.252.171:8000/api/games \
  -H "Content-Type: application/json" \
  -d '{"num_players": 4, "small_blind": 10, "big_blind": 20}'
# åº”è¯¥è¿”å›æ¸¸æˆä¿¡æ¯ï¼ŒåŒ…å« game_id
```

### 4. æµ‹è¯• AI åŠŸèƒ½ï¼ˆæ–°ç«¯ç‚¹ï¼‰
```bash
# å‡è®¾ game_id æ˜¯ abc123
curl -X POST http://13.212.252.171:8000/api/games/abc123/start
curl -X POST http://13.212.252.171:8000/api/games/abc123/deal
curl -X POST http://13.212.252.171:8000/api/games/abc123/ai-action
```

åº”è¯¥è¿”å› AI ç©å®¶çš„åŠ¨ä½œä¿¡æ¯

### 5. æµ‹è¯•å‰ç«¯
è®¿é—®ï¼š`http://13.212.252.171/game/{game_id}`
- å¯ç”¨ AI æ¨¡å¼å¼€å…³
- ç‚¹å‡»"å¼€å§‹è‡ªåŠ¨æ¸¸æˆ"
- è§‚å¯Ÿæ¸¸æˆæ˜¯å¦è‡ªåŠ¨è¿›è¡Œ

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¿«é€Ÿæ›´æ–°åä»£ç æ²¡ç”Ÿæ•ˆï¼Ÿ

**A**: å¯èƒ½å®¹å™¨ç¼“å­˜äº† Python å­—èŠ‚ç 

```bash
# æ¸…ç† Python ç¼“å­˜
docker exec backend find . -type d -name __pycache__ -exec rm -rf {} +

# é‡å¯æœåŠ¡
docker-compose restart backend
```

### Q: éœ€è¦å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Ÿ

**A**: ä½¿ç”¨ git å›é€€
```bash
# æŸ¥çœ‹æäº¤å†å²
git log --oneline -10

# å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬ï¼ˆä¾‹å¦‚ 463451bï¼‰
git reset --hard 463451b

# é‡å¯æœåŠ¡
docker-compose restart
```

### Q: å‰ç«¯ä»£ç æ²¡ç”Ÿæ•ˆï¼Ÿ

**A**: å‰ç«¯éœ€è¦é‡æ–°æ„å»ºï¼ˆä½¿ç”¨ Viteï¼‰
```bash
# è¿›å…¥å‰ç«¯å®¹å™¨
docker exec -it frontend sh

# é‡æ–°æ„å»º
npm run build

# æˆ–è€…é‡å¯å‰ç«¯æœåŠ¡
docker-compose restart frontend
```

### Q: ä»€ä¹ˆæ—¶å€™éœ€è¦å®Œæ•´ rebuildï¼Ÿ

**A**: åªæœ‰è¿™äº›æƒ…å†µï¼š
- ä¿®æ”¹äº† `requirements.txt` æˆ– `package.json`
- ä¿®æ”¹äº† `Dockerfile`
- æ·»åŠ äº†æ–°çš„ç³»ç»Ÿä¾èµ–
- ä¿®æ”¹äº† `docker-compose.yml` é…ç½®

---

## ğŸ“Š æ›´æ–°å†å²è®°å½•

### æœ€æ–°æ›´æ–° (2026-01-12)

**Commit**: `b570c5e` - åœ¨ games è·¯ç”±ä¸­æ·»åŠ  AI å•æ­¥åŠ¨ä½œç«¯ç‚¹

**å˜æ›´æ–‡ä»¶**ï¼š
- `backend/app/routers/games.py`
- `frontend/src/api/index.js`

**æ›´æ–°æ–¹å¼**ï¼šå¿«é€Ÿæ›´æ–°ï¼ˆrestart å³å¯ï¼‰

**åŠŸèƒ½**ï¼š
- æ·»åŠ  `/api/games/{id}/ai-action` ç«¯ç‚¹
- å‰ç«¯è°ƒç”¨æ–°ç«¯ç‚¹å®ç° AI è‡ªåŠ¨æ¸¸æˆ
- ä¸å†ä¾èµ– simulation è·¯ç”±

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å¼€å‘ç¯å¢ƒ**ï¼šé¢‘ç¹ä¿®æ”¹ä»£ç æ—¶ï¼Œä½¿ç”¨ `docker-compose restart` å¿«é€Ÿé‡å¯

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
   - å®šæœŸå®Œæ•´ rebuildï¼ˆæ¯å‘¨ä¸€æ¬¡ï¼‰
   - ä»£ç æ›´æ–°åå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - æ›´æ–°å‰å¤‡ä»½æ•°æ®åº“

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å°
   - åˆç†ä½¿ç”¨ .dockerignore
   - åˆ©ç”¨ Docker å±‚ç¼“å­˜

4. **æ—¥å¿—ç®¡ç†**ï¼š
   ```bash
   # æŒç»­æŸ¥çœ‹æ—¥å¿—
   docker logs -f backend

   # æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
   docker logs backend --tail 100

   # æŸ¥çœ‹æ—¶é—´èŒƒå›´å†…çš„æ—¥å¿—
   docker logs backend --since 10m
   ```

---

ç”Ÿæˆæ—¶é—´: 2026-01-12
